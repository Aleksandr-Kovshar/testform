{"mappings":"AAGyB,MAAnBA,EACJ,mHAGIC,EAAOC,SAASC,cAAc,SAGgBF,EAA/CG,OAASJ,EAaqBC,EAA9BI,iBAAiB,UAAUC,MAAMC,IAETA,EAAxBC,iBAG0B,MAAvBC,EAAOP,SAASC,cAAc,eAC9BO,EAAQR,SAASC,cAAc,gBAC/BQ,EAAQT,SAASC,cAAc,gBAC/BS,EAAUV,SAASC,cAAc,kBACjCU,EAAOX,SAASC,cAAc,eAGN,IAA1BW,EAAU,CACZL,KAAMA,EAAKM,MAAMC,OACjBN,MAAOA,EAAMK,MAAMC,OACnBL,MAAOA,EAAMI,MAAMC,OACnBJ,QAASA,EAAQG,MAAMC,OACvBH,KAAMA,EAAKI,SAIyB,IA/BQ,SAA9BH,GAChB,MAAML,KAAEA,EAAIC,MAAEA,EAAKC,MAAEA,EAAKE,KAAEA,GAASC,EACrC,SAAKL,GACAC,GACAC,GACAE,E,CA0BAK,CAASJ,GAAU,OAGO,IAA3BK,EAAW,GACf,IAAK,IAAIC,KAAYN,EAAS,CAEO,IAA/BO,EAAaC,mBAAmBF,GAChCG,EAAeD,mBAAmBR,EAAQM,IAC9CD,EAASK,KAAKH,EAAa,IAAME,E,CAGNJ,EAAlBA,EAASM,KAAK,KAGD,MAAlBC,QAAeC,MAAM3B,EAAS,CAClC4B,OAAQ,OACRC,QAAS,CACP,eAAgB,mDAGJC,KAAR,OACNC,KAAMZ,IAELa,MAAKC,GAAOA,EAAIC,SAChBC,OAAMC,GAAOC,MAAM,aAGF,YAAhBX,EAAOY,OACT7B,EAAKM,MAAQ,GACbL,EAAMK,MAAQ,GACdJ,EAAMI,MAAQ,GACdH,EAAQG,MAAQ,GAChBsB,MAAM,uBAEY,UAAhBX,EAAOY,MACTD,MAAM,WAACX,EAAgBa,SAAO","sources":["src/index.js"],"sourcesContent":["// в эту константу помещаем URL развёрнутого веб-приложения Google Apps Script\n// ВНИМАНИЕ! Это должен быть адрес ВАШЕГО РАЗВЕРНУТОГО ПРИЛОЖЕНИЯ\n// ТЕКУЩИЙ URL_APP приведён для примера\nconst URL_APP =\n  \"https://script.google.com/macros/s/AKfycby-Ae8neWIZ9CG2mmSA-LQnPOCtG8bHG2NPXrnG8V_a1VcDfkCIXO1QxmQnWjJR3MlA/exec\";\n\n// находим форму в документе\nconst form = document.querySelector(\"#form\");\n\n// указываем адрес отправки формы (нужно только в начале примера)\nform.action = URL_APP;\n\n// вспомогательная функция проверки заполненности формы\nfunction isFilled(details) {\n  const { name, email, phone, rule } = details;\n  if (!name) return false;\n  if (!email) return false;\n  if (!phone) return false;\n  if (!rule) return false;\n  return true;\n}\n\n// навешиваем обработчик на отправку формы\nform.addEventListener(\"submit\", async ev => {\n  // отменяем действие по умолчанию\n  ev.preventDefault();\n\n  // получаем ссылки на элементы формы\n  const name = document.querySelector(\"[name=name]\");\n  const email = document.querySelector(\"[name=email]\");\n  const phone = document.querySelector(\"[name=phone]\");\n  const message = document.querySelector(\"[name=message]\");\n  const rule = document.querySelector(\"[name=rule]\");\n\n  // собираем данные из элементов формы\n  let details = {\n    name: name.value.trim(),\n    email: email.value.trim(),\n    phone: phone.value.trim(),\n    message: message.value.trim(),\n    rule: rule.checked,\n  };\n\n  // если поля не заполнены - прекращаем обработку\n  if (!isFilled(details)) return;\n\n  // подготавливаем данные для отправки\n  let formBody = [];\n  for (let property in details) {\n    // кодируем названия и значения параметров\n    let encodedKey = encodeURIComponent(property);\n    let encodedValue = encodeURIComponent(details[property]);\n    formBody.push(encodedKey + \"=\" + encodedValue);\n  }\n  // склеиваем параметры в одну строку\n  formBody = formBody.join(\"&\");\n\n  // выполняем отправку данных в Google Apps\n  const result = await fetch(URL_APP, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/x-www-form-urlencoded;charset=UTF-8\",\n    },\n    //cors: \"no-cors\", <- это неправильно\n    mode: \"cors\", //<- оставим по умолчанию\n    body: formBody,\n  })\n    .then(res => res.json())\n    .catch(err => alert(\"Ошибка!\"));\n  // .then((res) => console.log(res));\n\n  if (result.type === \"success\") {\n    name.value = \"\";\n    email.value = \"\";\n    phone.value = \"\";\n    message.value = \"\";\n    alert(\"Спасибо за заявку!\");\n  }\n  if (result.type === \"error\") {\n    alert(`Ошибка( ${result.errors}`);\n  }\n});\n\n//Код Google Apps Script\n\n/*\n//ТУТ КОД ВАШЕГО РАЗВЕРТЫВАНИЯ\nconst SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1qwro6c_Jo_6-NZQ1YxabB4VoO3taIAYLhPZuwE9NSMA/edit#gid=0';\nconst SHEET_NAME = \"Лист1\";\n\nfunction doPost(e) {\n  const sheets = SpreadsheetApp.openByUrl(SHEETS_URL);\n  const sheet = sheets.getSheetByName(SHEET_NAME);\n  const errors = [];\n\n  let { name, email, phone, rule, message } = e.parameter;\n\n  const emailRegExp = /^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/;\n\n  if( name.length > 20 ){\n    errors.push(['name', 'попытка ввода очень длинной строки'])\n  }\n  if( email.length > 40 ){\n    errors.push(['email', 'попытка ввода очень длинной строки'])\n  }\n  if( phone.length > 12 ){\n    errors.push(['phone', 'попытка ввода очень длинной строки'])\n  }\n  if( message.length > 100 ){\n    errors.push(['message', 'попытка ввода очень длинной строки'])\n  }\n  if( !emailRegExp.test(email) ){\n    errors.push(['email', 'некорректный емейл'])\n  }\n  if( !rule ){\n    errors.push(['rule', 'не выбран флажок согласия с обработкой данных'])\n  }\n\n  if( errors.length ){\n    return ContentService\n    .createTextOutput(JSON.stringify({ \"type\": \"error\", \"errors\": errors }))\n    .setMimeType(ContentService.MimeType.JSON);\n  }\n\n  sheet.appendRow([name, email, ' ' + phone, rule, new Date().toISOString(), message.slice(0, 100)]);\n\n  return ContentService\n    .createTextOutput(JSON.stringify({ \"type\": \"success\" }))\n    .setMimeType(ContentService.MimeType.JSON);\n\n}\n*/\n"],"names":["$1f0dc3b9307be026$var$URL_APP","$1f0dc3b9307be026$var$form","document","querySelector","action","addEventListener","async","ev","preventDefault","name","email","phone","message","rule","details","value","trim","checked","$1f0dc3b9307be026$var$isFilled","formBody","property","encodedKey","encodeURIComponent","encodedValue","push","join","result","fetch","method","headers","mode","body","then","res","json","catch","err","alert","type","errors"],"version":3,"file":"index.933836be.js.map"}